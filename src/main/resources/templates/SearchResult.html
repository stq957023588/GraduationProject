<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Title</title>
</head>
<link type="text/css" rel="stylesheet" th:href="@{/css/bootstrap.min.css}"/>
<link type="text/css" rel="stylesheet" th:href="@{/css/Common.css}"/>
<style>
    .headPicDiv{
        display: inline-block;
    }
</style>


<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="/home" style="font-size: 20px">Home</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <!--<li class="active"><a href="javascript:void(0)">Show Your Strategy</a></li>-->
                <li><a href="/StrategyWrite">Show Your Strategy</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right nav-pills" >
                <li th:if="${session.user}==null">
                    <a href="registerEnter">
                        <span class="glyphicon glyphicon-user"></span>
                        Register
                    </a>
                </li>
                <li th:if="${session.user}==null">
                    <a href="loginEnter">
                        <span class="glyphicon glyphicon-log-in"></span>
                        Login
                    </a>
                </li>
                <li th:if="${session.user}!=null" class="dropdown">
                    <a id="infoDropdown" class="dropdown-toggle" data-toggle="dropdown" href="javascript:void(0)" th:text="${session.user.getName()}"></a>
                    <input id="hiddenAccount" type="hidden" th:value="${session.user.getAccount()}">
                    <ul class="dropdown-menu dropdown-menu-left" role="menu" aria-labelledby="infoDropdown">
                        <li role="presentation">
                            <a role="menuitem" tabindex="-1" th:href="@{'/personalPage?pageName=个人资料&account='+${session.user.getAccount()}}">个人中心</a>
                            <a role="menuitem" tabindex="-1" th:href="@{/Admin}" id="admin" th:if="${session.user.getIsSysAdmin()==1}">管理员</a>
                            <a role="menuitem" tabindex="-1" href="javascript:void(0)" id="loginOut">退出登陆</a>
                        </li>
                    </ul>

                </li>
                <li th:if="${session.user}!=null">
                    <a href="/Chat">
                        消息
                        <span id="msgNum" class="badge pull-right"></span>
                    </a>
                </li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>
<div class="container" style="margin-top: 100px">
    <div class="row">
        <!--<div class="col-md-1 text-center blue">1</div>-->
        <!--<div class="col-md-1 text-center green">1</div>-->
        <!--<div class="col-md-1 text-center blue">1</div>-->
        <!--<div class="col-md-1 text-center green">1</div>-->
        <!--<div class="col-md-1 text-center blue">1</div>-->
        <!--<div class="col-md-1 text-center green">1</div>-->
        <!--<div class="col-md-1 text-center blue">1</div>-->
        <!--<div class="col-md-1 text-center green">1</div>-->
        <!--<div class="col-md-1 text-center blue">1</div>-->
        <!--<div class="col-md-1 text-center green">1</div>-->
        <!--<div class="col-md-1 text-center blue">1</div>-->
        <!--<div class="col-md-1 text-center green">1</div>-->
    </div>

    <div class="row" >
        <div class="col-md-8 col-md-offset-2 " style="padding: 0"  >
            <div class="row" style="padding: 0">
                <div id="searchConditionBox" class="col-md-12 " style="padding:0" th:text="'搜索条件:'+${condition}">
                    用户:
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 col-md-offset-2" style="padding: 0">
            <div class="row input-group" style="height: 50px;padding: 8px 0">
                <span id="searchBtn" class="input-group-addon on-put">搜索</span>
                <input id="searchBox" type="text" class="form-control" placeholder="想找什么?">
            </div>
        </div>
    </div>



    <div class="row" >
        <div class="col-md-8 col-md-offset-2  mtop10" style="font-size: 18px;padding: 5px 0px;">
            <div class="row" style="padding: 0">
                <div class="col-md-12 nav-2" style="padding: 5px 15px">
                    用户:
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div id="users" class="col-md-8 col-md-offset-2 " style="padding: 0">

            <!--<div class="userInfo mtop10">-->
                <!--<div class="headPicDiv" style="float: left">-->
                    <!--<img src="/img/ymc_.jpg" class="headPicCss-b">-->
                <!--</div>-->
                <!--<div class="userProperty" style="display: inline-block;padding-left: 50px">-->
                    <!--<div style="height: 64px;font-size: 19px;line-height: 49px;padding-top: 15px">-->
                        <!--<span>9999999</span>-->
                    <!--</div>-->
                    <!--<div style="height:64px;line-height: 49px;padding-bottom: 15px">-->
                        <!--<span>粉丝数:</span>-->
                        <!--<span>555</span>-->
                        <!--<span>投稿数:</span>-->
                        <!--<span>555</span>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div class="all-center" style="float: right;height: 128px;width: 200px;">-->
                    <!--<button type="button" class="col-md-4 col-md-offset-4 btn btn-info">关注</button>-->
                <!--</div>-->
            <!--</div>-->

        </div>
    </div>

    <div class="row" >
        <div class="col-md-8 col-md-offset-2  mtop10" style="padding: 5px 0px;font-size: 18px">
            <div class="row" style="padding: 0">
                <div class="col-md-12 nav-2" style="padding: 5px 15px">
                    攻略:
                </div>
            </div>
        </div>
    </div>
    <div class="row" >
        <div id="artilces" class="col-md-8 col-md-offset-2" style="padding: 0"></div>
    </div>

</div>
</body>
<script type="text/javascript" th:src="@{/js/jquery-3.3.1.min.js}"></script>
<script type="text/javascript" th:src="@{/js/bootstrap.min.js}"></script>
<script type="text/javascript" th:src="@{/js/tools.js}"></script>
<script type="text/javascript" th:src="@{/plus/layer/layer.js}"></script>
<script type="text/javascript" th:src="@{/js/websocketConnect.js}"></script>
<script type="text/javascript" th:inline="javascript">

    //----------------------------websocket----------------------------
    if($("#infoDropdown").length>0){
        //websocket 启动
        var websocket=websocketConnect($("#hiddenAccount").val());
        //websocket 接收到消息后的回调方法
        websocket.onmessage=function (ev) {
            console.log(ev);
            if($("#msgNum").html()=="" || $("#msgNum").html()==null){
                $("#msgNum").html(1);
            }else{
                var oldMsgNum=parseInt($("#msgNum").html());
                $("#msgNum").html(oldMsgNum+1);
            }
        }
        loadUnreadMsgNum($("#hiddenAccount").val());
    }
    //----------------------------------------------------------------


    function init(condition){
        $("#users").empty();
        $("#artilces").empty();
        $.ajax({
            type:'post',
            url:'searchStrategies',
            data:{
                condition:condition
            },
            dataType:'json',
            success:function (data) {
                // console.log(data);
                if(data.data.users.length<=0){
                    $("<div class=\"row all-center blankDiv mtop10\">没有这样的人哦....</div>").appendTo($("#users"));
                }else{
                    addUserElements(data.data.users);
                }
                if(data.data.strategies<=0){
                    $("<div class=\"row all-center blankDiv mtop10\">什么都没查到....</div>").appendTo($("#artilces"));
                }else{
                    addStrategyElements(data.data.strategies);
                }


            },
            error:function (e) {
                console.log(e);
            }
        });
    }

    




</script>

<script type="text/javascript" th:inline="javascript">
    //初始化

    init([[${condition}]]);

    $("#searchBtn").click(function(){
        if($("#searchBox").val()=="" || $("#searchBox").val()==null){
            layer.msg("不能为空");
        }else{
            window.location.href="SearchResult?condition="+$("#searchBox").val();
        }
    })

</script>
</html>